{"version":3,"sources":["webpack:///webpack/bootstrap 2b59dc9663eb2e88e2dc","webpack:///./src/services/companiesHouse.js","webpack:///external \"axios\"","webpack:///./src/index.js","webpack:///external \"hapi\"","webpack:///./src/modules/companies/index.js","webpack:///./src/modules/companies/fetchCompany.js","webpack:///external \"uuid\"","webpack:///./src/services/rbs.js","webpack:///./src/mocks/rbs-business-profile.json","webpack:///./src/services/experian.js","webpack:///./src/modules/companies/searchCompanies.js"],"names":["axios","require","apiKey","baseUrl","requiredParamAsync","paramName","Promise","resolve","reject","Error","get","url","query","requestConfig","auth","username","password","params","q","then","r","data","fetchCompany","companyNumber","all","fetchCompanyProfile","fetchCompanyAddress","fetchCompanyOfficers","profile","address","officers","items","searchAll","searchForCompanies","searchForOfficers","searchForDisqualifiedOfficers","module","exports","Hapi","companiesApi","server","host","port","process","env","PORT","init","register","start","initialisedServer","console","log","info","uri","catch","err","on","exit","fetchCompanyHandler","searchCompaniesHandler","name","route","method","path","handler","v4","companiesHouseService","rbsService","experianService","request","encodeURIComponent","error","rbsData","chData","expData","individuals","map","occupation","id","role","line1","address_line_1","line2","address_line_2","line3","address_line_3","country","postcode","postal_code","premises","_raw","providers","companiesHouse","experian","mockedResponse","businessName","registrationAddress","tradingAddress","correspondenceAddress","businessAddress","businessType","registrationNumber","userDetails","sicCode","businessDetails","permissions","permissionDetails","getIndividuals","person","UNIQUE_OBJECT_ID","personName","position","positionLabels","company","type","value","number","sic","code","description","registered","label","trading","correspondence","shareholders","API_BASE_URL","TOKEN_URL","PROFILE_URL","CLIENT_ID","CLIENT_SECRET","CLIENT_USERNAME","CLIENT_PASSWORD","access_token","refresh_token","response","headers","Client_id","Client_secret","Authorization","SearchResults"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2b59dc9663eb2e88e2dc","const axios = require('axios');\n\n// todo move to .env file\nconst apiKey = 'Y38eajScB0cT55FlDo-9esuGLxnCYDGp1JtxtZ7l';\nconst baseUrl = 'https://api.companieshouse.gov.uk';\n\n// TODO: move to a separate package\n// TODO: document\nconst requiredParamAsync = paramName =>\n  new Promise((resolve, reject) => {\n    reject(new Error(`The parameter \"${paramName}\" is required and not empty nor null`));\n  });\n\nconst get = ({ apiKey, url, query } = {}) => {\n  if (!apiKey) {\n    requiredParamAsync('apiKey');\n  }\n\n  if (!url) {\n    requiredParamAsync('url');\n  }\n\n  let requestConfig = { auth: { username: apiKey, password: '' } };\n\n  if (query) {\n    requestConfig = { ...requestConfig, params: { q: query } };\n  }\n\n  return axios.get(`${baseUrl}${url}`, requestConfig).then(r => r.data);\n};\n\n// Profile\nconst fetchCompany = ({ companyNumber }) =>\n  Promise.all([\n    fetchCompanyProfile({ companyNumber }),\n    fetchCompanyAddress({ companyNumber }),\n    fetchCompanyOfficers({ companyNumber }),\n  ]).then(([profile, address, officers]) => ({ profile, address, officers }));\nconst fetchCompanyProfile = ({ companyNumber } = {}) =>\n  !companyNumber\n    ? requiredParamAsync('companyNumber')\n    : get({ apiKey, url: `/company/${companyNumber}` });\nconst fetchCompanyAddress = ({ companyNumber } = {}) =>\n  !companyNumber\n    ? requiredParamAsync('companyNumber')\n    : get({ apiKey, url: `/company/${companyNumber}/registered-office-address` });\nconst fetchCompanyOfficers = ({ companyNumber } = {}) =>\n  !companyNumber\n    ? requiredParamAsync('companyNumber')\n    : get({ apiKey, url: `/company/${companyNumber}/officers` }).then(r => r.items); // todo: check whether there are more items\n\n// Search\nconst searchAll = ({ query } = {}) =>\n  !query ? requiredParamAsync('companyNumber') : get({ apiKey, url: '/search', query });\nconst searchForCompanies = ({ query } = {}) =>\n  !query ? requiredParamAsync('companyNumber') : get({ apiKey, url: '/search/companies', query });\nconst searchForOfficers = ({ query } = {}) =>\n  !query ? requiredParamAsync('companyNumber') : get({ apiKey, url: '/search/officers', query });\nconst searchForDisqualifiedOfficers = ({ query } = {}) =>\n  !query\n    ? requiredParamAsync('companyNumber')\n    : get({ apiKey, url: '/search/disqualified-officers', query });\n\nmodule.exports = {\n  fetchCompany,\n  fetchCompanyProfile,\n  fetchCompanyAddress,\n  fetchCompanyOfficers,\n  searchAll,\n  searchForCompanies,\n  searchForOfficers,\n  searchForDisqualifiedOfficers,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/companiesHouse.js","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 1\n// module chunks = 0","const Hapi = require('hapi');\n\nconst companiesApi = require('./modules/companies');\n\n// Create a server with a host and port\nconst server = Hapi.server({\n  host: '0.0.0.0',\n  port: process.env.PORT || 3000,\n});\n\n// Start the server\nconst init = async () => {\n  await server.register(companiesApi);\n  await server.start();\n  return server;\n};\n\ninit()\n  .then(initialisedServer => {\n    console.log('Server running at:', initialisedServer.info.uri);\n  })\n  .catch(err => {\n    console.log(err);\n  });\n\nprocess.on('unhandledRejection', err => {\n  console.log(err);\n  process.exit(1);\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"hapi\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"hapi\"\n// module id = 4\n// module chunks = 0","const fetchCompanyHandler = require('./fetchCompany');\nconst searchCompaniesHandler = require('./searchCompanies');\n\nconst companiesApi = {\n  name: 'CompaniesApi',\n  register: async server => {\n    server.route([\n      {\n        method: 'GET',\n        path: '/company/{companyNumber}',\n        handler: fetchCompanyHandler,\n      },\n      {\n        method: 'GET',\n        path: '/search/companies',\n        handler: searchCompaniesHandler,\n      },\n    ]);\n  },\n};\n\nmodule.exports = companiesApi;\n\n\n\n// WEBPACK FOOTER //\n// ./src/modules/companies/index.js","const { v4 } = require('uuid');\n\nconst companiesHouseService = require('../../services/companiesHouse');\nconst rbsService = require('../../services/rbs');\nconst experianService = require('../../services/experian');\n\nconst fetchCompanyHandler = async request => {\n  const companyNumber = encodeURIComponent(request.params.companyNumber); // 01897720\n  // todo: companyNumber exists \"locally\"? fetch it : parse and save it\n\n  // perform all inits/logins at the same time\n  try {\n    await Promise.all([experianService.init()]);\n    console.log('✔ successfully logged in');\n  } catch (error) {\n    console.log(error);\n  }\n\n  const [rbsData, chData, expData] = await Promise.all([\n    rbsService.fetchCompany({ companyNumber }),\n    companiesHouseService.fetchCompany({ companyNumber }),\n    experianService.fetchCompany({ companyNumber }),\n  ]);\n\n  return {\n    ...rbsData,\n    individuals: chData.officers.map(({ name, occupation, address }) => ({\n      id: v4(),\n      name: name,\n      role: occupation,\n      address: {\n        line1: address.address_line_1 && address.address_line_1,\n        line2: address.address_line_2 && address.address_line_2,\n        line3: address.address_line_3 && address.address_line_3,\n        country: address.country,\n        postcode: address.postal_code,\n        premises: address.premises,\n      },\n    })),\n    _raw: {\n      providers: {\n        companiesHouse: chData,\n        experian: expData,\n      },\n    },\n  };\n};\n\nmodule.exports = fetchCompanyHandler;\n\n\n\n// WEBPACK FOOTER //\n// ./src/modules/companies/fetchCompany.js","module.exports = require(\"uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 7\n// module chunks = 0","const mockedResponse = require('../mocks/rbs-business-profile.json');\n\nconst requiredParamAsync = paramName =>\n  new Promise.reject(new Error(`The parameter \"${paramName}\" is required and not empty nor null`));\n\nconst fetchCompany = ({ companyNumber } = {}) => {\n  const {\n    businessName,\n    registrationAddress,\n    tradingAddress,\n    correspondenceAddress,\n  } = mockedResponse.businessAddress;\n  const { businessType, registrationNumber } = mockedResponse.userDetails;\n  const { sicCode } = mockedResponse.businessDetails;\n  const { permissions } = mockedResponse.permissionDetails;\n  const getIndividuals = permissions =>\n    permissions.map(person => ({\n      id: person.UNIQUE_OBJECT_ID,\n      name: person.personName,\n      position: person.positionLabels,\n    }));\n\n  return !companyNumber\n    ? requiredParamAsync('companyNumber')\n    : Promise.resolve({\n        company: {\n          name: businessName,\n          type: businessType.value,\n          number: registrationNumber,\n          sic: { code: sicCode.code, description: sicCode.value },\n          id: 1,\n          address: {\n            registered: { ...registrationAddress, label: 'Registered' },\n            trading: { ...tradingAddress, label: 'Trading' },\n            correspondence: { ...correspondenceAddress, label: 'Correspondence' },\n          },\n        },\n        individuals: getIndividuals(permissions),\n        shareholders: {},\n      });\n};\n\nmodule.exports = {\n  fetchCompany,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/rbs.js","module.exports = {\"summary\":{\"requiresEmailMarketing\":false,\"requiresTextMarketing\":true,\"requiresPhoneCallMarketing\":true,\"requiresPostMarketing\":false},\"permissionDetails\":{\"checkPermissions\":false,\"groups\":[],\"permissions\":[{\"personName\":\"GEORGIA HUGHES\",\"UNIQUE_OBJECT_ID\":\"auto-cjhrpbbii0000375jor7ol70e\",\"position\":\"D, SH\",\"positionLabels\":\"Director, Shareholder\",\"dateOfBirth\":\"1983-09-17\",\"accountSignatory\":true,\"isMemberPartner\":false,\"hasSignChoice\":true},{\"personName\":\"Test Test\",\"UNIQUE_OBJECT_ID\":\"kp-cjik1nazu00013c5mjm6oan1v\",\"position\":\"D, SH\",\"positionLabels\":\"Director, Shareholder\",\"dateOfBirth\":\"1999-02-01\",\"accountSignatory\":true,\"isMemberPartner\":false,\"hasSignChoice\":true}],\"signatoryOptions\":\"oneSignatory\",\"hasSignatoryGroupsLimit\":false,\"willApplyToFutureAccounts\":false,\"allSignatoriesSignUnlimitedAmounts\":false,\"hasSigningGroups\":false,\"otherSigningRules\":\"\",\"signingGroupsLimit\":0,\"groupAssigned\":\"\",\"synchronizedWithTeamDetails\":true},\"accessDetails\":{\"personsItems\":[{\"personName\":\"GEORGIA HUGHES\",\"UNIQUE_OBJECT_ID\":\"auto-cjhrpbbii0000375jor7ol70e\",\"dateOfBirth\":\"1983-09-17\",\"position\":\"D, SH\",\"requiresDebitCard\":true,\"debitCardIndividualName\":\"G HUGHES\"},{\"personName\":\"Test Test\",\"UNIQUE_OBJECT_ID\":\"kp-cjik1nazu00013c5mjm6oan1v\",\"dateOfBirth\":\"1999-02-01\",\"position\":\"D, SH\",\"requiresDebitCard\":true,\"debitCardIndividualName\":\"T Test\"}],\"requiresPaperStatements\":false,\"requiresPayingInBook\":false,\"requiresChequeBook\":true,\"additionalProducts\":{\"requiresOverdraft\":false,\"requiresCreditCard\":true,\"requiresDepositAccount\":false,\"requiresWorldPay\":false},\"creditCardDetails\":{\"cardHolders\":[[null]],\"signingPerson\":{\"firstName\":\"GEORGIA\",\"surname\":\"HUGHES\",\"dateOfBirth\":\"1983-09-17\",\"UNIQUE_OBJECT_ID\":\"auto-cjhrpbbii0000375jor7ol70e\"},\"SRFP\":\"GEORGIA|HUGHES||D:SH|1983260|101 BEECH ROAD:FELTHAM:MIDDLESEX::GBR:TW14 8AJ:201432||Test|Test||D:SH|199932|101 BEECH ROAD:FELTHAM:MIDDLESEX::GBR:TW14 8AJ:2000306||\",\"nameOnCard\":\"SEDGEFIELD WINDOWS\",\"BNFP\":\"SEDGEFIELD WINDOWS & BUILDING LTD\",\"numberOfCards\":1,\"directDebitOption\":{\"code\":\"FP\",\"value\":\"Full Payment(Total Balance)\"},\"directDebitAccount\":{\"directDebitAccountHolderName\":\"\",\"sortCode\":\"\",\"directDebitAccountNumber\":\"\",\"isNewAccount\":true},\"businessName\":\"SEDGEFIELD WINDOWS & BUILDING LTD\",\"businessAddress\":{\"line5\":[null],\"postCode\":\"TS21 2BL\",\"line2\":\"STOCKTON-ON-TEES\",\"line1\":\"7 RECTORY ROW SEDGEFIELD\"},\"creditcardType\":\"Non CCA Simple Form\"},\"requiresOnlineBanking\":true,\"requiresAdditionalAccounts\":false,\"businessAccountOperational\":{},\"debitCardName\":\"SEDGEFIELD WINDOWS & BUILDING LTD\",\"synchronizedWithTeamDetails\":true,\"requiresEmailMarketing\":false,\"requiresTextMarketing\":true,\"requiresPhoneCallMarketing\":true,\"requiresPostMarketing\":false,\"isComplexCardApplication\":false,\"paperStatement\":{}},\"businessDetails\":{\"sicCode\":{\"activityId\":12754,\"code\":\"12706\",\"sicCode\":\"33.20/2/0\",\"sic2007Code\":\"26513\",\"busSubSector\":\"Manufacture of non-electronic instruments and appliances for measuring, checking\",\"boeCode\":\"LLN\",\"value\":\"Test benches, non-electronic, mfr.\",\"suppQuestionId\":\"\"},\"turnover\":{\"code\":\"80000\",\"value\":\"Â£70,001 - Â£80,000\"},\"dateStartedTrading\":\"2017-02-01\",\"financialYearEnd\":\"2018-01-31\",\"fullTimeEmployees\":\"3\",\"tradingDescription\":\"My business is a Chinese take away serving traditional Chinese food such as noodles, fried dishes, serving starters, mains, desserts and soft drinks. We offer a collection and delivery service. Typical food prices range from Â£5 - Â£12. Average customer spends Â£12 - Â£15 weekly of which total taking per week is approximately Â£1500 which equates to a projected turnover of Â£78,000 per annum. I mainly serve customers in the local area and will be managing the day to day running of the business\",\"hasLegalProceedings\":false,\"accountPaymentTypes\":[{\"type\":\"cheques\"}],\"taxResidencyCountry\":[],\"initialDeposit\":[],\"legalProceedingsDescription\":\"\",\"fluctuationsExplanation\":\"\",\"partTimeEmployees\":0,\"isRegisteredForNonUKTax\":false,\"nonUKRelationship\":{\"paymentsMade\":[],\"paymentsReceived\":[],\"isPaymentsMade\":false,\"isPaymentsReceived\":false,\"paymentsMadePurposeDescription\":\"\",\"paymentsReceivedPurposeDescription\":\"\",\"isHoldMaterialAssetsOutsideUK\":false,\"holdMaterialAssetsList\":[],\"isHaveSupliersOrOperationsOutsideUK\":false,\"suppliersOrOperationsList\":[]},\"hasFluctuations\":false,\"hasExistingBusinessRelationship\":false,\"isSwitcher\":false,\"hasInitialDeposit\":false},\"businessAddress\":{\"businessName\":\"SEDGEFIELD WINDOWS & BUILDING LTD\",\"registrationAddress\":{\"line1\":\"7 RECTORY ROW SEDGEFIELD\",\"line2\":\"STOCKTON-ON-TEES\",\"line5\":{\"code\":\"GBR\",\"value\":\"United Kingdom\"},\"postCode\":\"TS21 2BL\"},\"tradingAddress\":{\"line1\":\"7 RECTORY ROW SEDGEFIELD\",\"line2\":\"STOCKTON-ON-TEES\",\"line5\":{\"code\":\"GBR\",\"value\":\"United Kingdom\"},\"postCode\":\"TS21 2BL\"},\"correspondenceAddress\":{\"line1\":\"7 RECTORY ROW SEDGEFIELD\",\"line2\":\"STOCKTON-ON-TEES\",\"line5\":{\"code\":\"GBR\",\"value\":\"United Kingdom\"},\"postCode\":\"TS21 2BL\"},\"correspondenceAddressType\":\"Registered Address\",\"isTradingNameSame\":true,\"isTradingAddressSame\":true,\"isCorrespondenceAddressSame\":true,\"otherNames\":\"\",\"isCorrespondenceAddressUK\":true,\"businessCountryPhysicallyBased\":{\"code\":\"GBR\",\"value\":\"United Kingdom\"},\"businessCountryOfRegistration\":{\"code\":\"GBR\",\"value\":\"United Kingdom\"},\"premisisOwnedLeased\":\"Leased\"},\"userDetails\":{\"title\":{\"code\":\"01\",\"value\":\"MR\"},\"firstName\":\"Mohammed\",\"surname\":\"Shariff\",\"businessEmail\":\"TESTINTUSR013@mde.rbs.co.uk\",\"isBasedUK\":true,\"businessType\":{\"code\":\"LC\",\"value\":\"Limited Company\"},\"registrationNumber\":\"11076174\",\"keyfactsCheckBox\":true},\"applicationInfo\":{\"createVersion\":11,\"processInstanceId\":24034,\"bankingDivision\":\"Business Banking\",\"lastModifiedDate\":\"2018-06-18 10:17:39\",\"channel\":\"Telephony Online\",\"type\":\"BB\",\"userId\":\"ZEBRA_NAGESH.POLEPALLY@RBS.CO.UK\",\"currentVersion\":11,\"subProductType\":\"Business Current Account\",\"createdByInternal\":true,\"applicationStatus\":\"Submitted\",\"stepName\":\"summary\",\"snapshotName\":\"EOBAO_2018MAY281006\",\"lastModifiedUser\":\"NAGESH.POLEPALLY@RBS.CO.UK\",\"arn\":\"NB00278762\",\"brand\":\"NATWEST\",\"taskId\":\"420510\",\"productType\":\"Current Account\",\"startDate\":\"2018-05-29 14:10:02\",\"sdd\":false,\"accountTitle\":\"SEDGEFIELD WINDOWS & BUILDING \",\"accountTitleDescription\":\"SEDGEFIELD WINDOWS & BUILDING LTD\",\"isTrustPlcOrOther\":false,\"businessInfoNotFetched\":false,\"beneficialOwnersNotFetched\":false,\"creditCardFeatureToggle\":true,\"isUKIA\":false},\"teamDetails\":{\"companies\":[],\"team\":[{\"firstName\":\"GEORGIA\",\"position\":[null],\"financialOwnership\":\"50\",\"surname\":\"HUGHES\",\"votingOwnership\":\"50\",\"kpOccupation\":[null],\"kpRelationship\":[null],\"countryCallingCode\":[null],\"UNIQUE_OBJECT_ID\":\"auto-cjhrpbbii0000375jor7ol70e\",\"dateOfBirth\":\"1983-09-17\",\"title\":[null],\"otherNames\":\"\",\"personalBankAccount\":{},\"nonUKTaxResidentCountryTIN\":\"\",\"cardType\":[],\"priorHomeAddresses\":[],\"timeInBusinessMonths\":7,\"timeInBusinessYears\":17,\"isMemberOfManagementBoard\":false,\"isKpHomeAddressUK\":true,\"contactName\":\"GEORGIA HUGHES\",\"countryOfBirth\":[null],\"nationality\":[null],\"kpCountryOfResidence\":[null],\"homeAddress\":[null],\"dateOfEntry\":\"2014-02-01\",\"email\":\"test@test.com\",\"phone\":\"7766554421\",\"gender\":\"male\",\"townOfBirth\":\"London\",\"hasPersonalBankAccount\":false,\"timeInBusiness\":\"2000-11-01T00:00:00.000Z\",\"isNonUKTaxResident\":false,\"isPrimaryContact\":true,\"kpHomeTelephoneNumber\":\"7766554421\",\"isUnder18\":false,\"hasBeenInsolvent\":false,\"dataLevel\":\"6\",\"memorableWord\":\"London\"},{\"UNIQUE_OBJECT_ID\":\"kp-cjik1nazu00013c5mjm6oan1v\",\"position\":[null],\"countryOfBirth\":[null],\"nationality\":[null],\"priorHomeAddresses\":[],\"personalBankAccount\":{},\"countryCallingCode\":[null],\"title\":[null],\"firstName\":\"Test\",\"surname\":\"Test\",\"dateOfBirth\":\"1999-02-01\",\"isPrimaryContact\":false,\"email\":\"test1@test.com\",\"phone\":\"7788996655\",\"gender\":\"female\",\"townOfBirth\":\"London\",\"hasPersonalBankAccount\":false,\"timeInBusiness\":\"2000-11-01T00:00:00.000Z\",\"isNonUKTaxResident\":false,\"homeAddress\":[null],\"kpCountryOfResidence\":[null],\"dateOfEntry\":\"2000-11-01\",\"votingOwnership\":\"50\",\"financialOwnership\":\"50\",\"kpOccupation\":[null],\"kpRelationship\":[null],\"otherNames\":\"\",\"nonUKTaxResidentCountryTIN\":\"\",\"cardType\":[],\"timeInBusinessMonths\":7,\"timeInBusinessYears\":17,\"isMemberOfManagementBoard\":false,\"isKpHomeAddressUK\":true,\"contactName\":\"Test Test\",\"kpHomeTelephoneNumber\":\"7788996655\",\"isUnder18\":false,\"hasBeenInsolvent\":false,\"dataLevel\":\"6\",\"memorableWord\":\"London\"}],\"teamIsValid\":true,\"hasManagementBoard\":false,\"businessEmail\":\"test@test.com\",\"contacts\":[],\"hasRbo\":false,\"teamDetailsAlreadySubmitted\":true}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/mocks/rbs-business-profile.json\n// module id = 9\n// module chunks = 0","const axios = require('axios');\n\nconst API_BASE_URL = 'https://sandbox-uk-api.experian.com';\nconst TOKEN_URL = `${API_BASE_URL}/oauth2/v1/token`;\nconst PROFILE_URL = `${API_BASE_URL}/risk/business/v1/businesstargeter`;\nconst CLIENT_ID = 'LnSftXjmh9hNGtUKyS8JxbX9RluG2xb9';\nconst CLIENT_SECRET = 'jO3AuQtk6qjeFkpN';\nconst CLIENT_USERNAME = 'xavier.fuentes@theappbusiness.com';\nconst CLIENT_PASSWORD = '77p*OAk6Pomr';\n\nlet access_token = null;\nlet refresh_token = null;\n\nconst init = async () => {\n  // if (!access_token) {\n  // get access token\n  console.log('Logging in Experian...');\n  const response = await axios({\n    method: 'post',\n    url: TOKEN_URL,\n    data: { username: CLIENT_USERNAME, password: CLIENT_PASSWORD },\n    headers: {\n      'Cache-Control': 'no-cache',\n      Client_id: CLIENT_ID,\n      Client_secret: CLIENT_SECRET,\n      'Content-Type': 'application/json',\n    },\n  })\n    .then(r => r.data)\n    .catch(error => {\n      console.log(error);\n    });\n  access_token = response.access_token;\n  refresh_token = response.refresh_token;\n  // } else {\n  //   console.log('already logged in -> ', access_token);\n  // }\n};\n\nconst fetchCompany = async ({ companyNumber }) => {\n  if (!access_token) {\n    await init();\n  }\n\n  // validate expired token\n\n  return axios({\n    method: 'get',\n    url: PROFILE_URL,\n    params: { name: 'Test' },\n    // params: { businessref: companyNumber },\n    headers: {\n      'Cache-Control': 'no-cache',\n      Authorization: `Bearer ${access_token}`,\n    },\n  })\n    .then(r => r.data)\n    .then(r => r.SearchResults[0]) // should be unique!\n    .catch(error => {\n      console.log(error);\n    });\n};\n\nmodule.exports = {\n  fetchCompany,\n  init,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/experian.js","const companiesHouseService = require('../../services/companiesHouse');\n\nconst searchCompaniesHandler = async request =>\n  companiesHouseService.searchForCompanies({ query: request.query.query }).then(({ data }) => data);\n\nmodule.exports = searchCompaniesHandler;\n\n\n\n// WEBPACK FOOTER //\n// ./src/modules/companies/searchCompanies.js"],"sourceRoot":""}